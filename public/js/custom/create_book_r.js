$(function(){froalaEditor();titleBook();chapterBook();isFree();backLink();toChaptList();saveDraft();addChapter();publishChapter();publishBook();getCategory()});
function publishBook(){$("#publish_book").click(function(){var a=new FormData;a.append("book_id",$("#uri").val());a.append("file_cover",$("#cover_name").val());a.append("category",$("#category_ids").val());$.ajax({url:base_url+"publishbook",dataType:"json",cache:!1,type:"POST",contentType:!1,processData:!1,data:a}).done(function(a){200==a.code&&(window.location=base_url+"timeline")}).fail(function(){console.log("error")})})}
function publishChapter(){$("#publish_chapter").click(function(){var a=$("#chapter_title_out").val(),b=$("#paragraph_book").val(),c=$("#book_id").val(),d=new FormData;d.append("book_id",c);d.append("chapter_title",a);d.append("paragraph",b);$.ajax({url:base_url+"cover",type:"POST",dataType:"json",data:{book_id:c,chapter_title:a,paragraph:b}}).done(function(a){200==a.code&&(window.location=base_url+"cover/"+a.data.book_id)}).fail(function(){console.log("error")})})}
function froalaEditor(){$.FroalaEditor.DefineIcon("imageInfo",{NAME:"info"});$.FroalaEditor.RegisterCommand("imageInfo",{title:"Info",focus:!1,undo:!1,refreshAfterCallback:!1,callback:function(){var a=this.image.get();alert(a.attr("src"))}});$("#paragraph_book").froalaEditor({imageEditButtons:["imageDisplay","imageAlign","imageInfo","imageRemove"],buttons:"undo redo sep bold italic underline".split(" "),placeholderText:"Tulis cerita di sini..",heightMin:200,heightMax:300,width:500,initOnClick:!0,
toolbarBottom:!0})}function titleBook(){$("#title_book_out").keyup(function(a){$("#title_book").val($(this).val())})}function chapterBook(){$("#chapter_title_out").keyup(function(a){$("#chapter_title").val($(this).val())});$(".paragraph").on("froalaEditor.keyup",function(a,b,c){$("#paragraph").val($(this).val())})}
function tampilkanPreview(a,b){for(var c=a.files,d=0;d<c.length;d++){var e=c[d],f=document.getElementById(b),g=new FileReader;console.log(e);e.type.match(/image.*/)?(f.file=e,g.onload=function(a){return function(b){a.src=b.target.result}}(f),g.readAsDataURL(e)):alert("Type file tidak sesuai. Khusus image.")}}function isFree(){$("#is_free").change(function(){$(this).is(":checked")?$(".rangebook").show():$(".rangebook").hide()})}
function backLink(){$(document).on("click","#backlinks",function(){new FormData;var a=$("#book_id").val(),b=$("#chapter_title_out").val(),c=$("#paragraph_book").val(),d=base_url+"savechapter";""!=b||""!=c?swal({title:"Ingin Kembali?",text:"Simpan cerita kamu dan menuju daftar cerita yang kamu buat.",showCancelButton:!0,confirmButtonColor:"#644cb6",cancelButtonColor:"#d33",confirmButtonText:"Simpan",cancelButtonText:"Batal"}).then(function(e){e.value&&(""==b||""==c?swal("Gagal!","Lengkapi Judul dan Isi Buku mu.",
"error"):$.ajax({type:"POST",url:d,data:{book_id:a,chapter_title:b,paragraph_book:c},dataType:"json",beforeSend:function(){swal({title:"Menyimpan Cerita",timer:6E4,onOpen:function(){swal.showLoading()}})},success:function(a){200==a.code&&(window.location=base_url+"listchapter/"+a.data.book_id)}}))}):window.location=base_url+"create_mybook"})}function toChaptList(){$(document).on("click","#backdraft",function(){var a=$("#book_id").val();window.location=base_url+"listchapter/"+a})}
function saveDraft(){$("#saveChapt").on("click",function(){new FormData;var a=$("#book_id").val(),b=$("#chapter_title_out").val(),c=$("#paragraph_book").val(),d=base_url+"savechapter";""==b||""==c?swal("Gagal!","Lengkapi Judul dan Isi Buku mu.","error"):$.ajax({type:"POST",url:d,data:{book_id:a,chapter_title:b,paragraph_book:c},dataType:"json",beforeSend:function(){swal({title:"Menyimpan Cerita",onOpen:function(){swal.showLoading()}})},success:function(a){if(200==a.code){swal.hideLoading();var b=
document.getElementById("snackbar");b.className="show";setTimeout(function(){b.className=b.className.replace("show","")},3E3);$("#backlinks").removeClass("backlink");$("#backlinks").attr("id","backdraft")}}})})}
function addChapter(){$("#addSome").on("click",function(){new FormData;var a=$("#book_id").val(),b=$("#chapter_title_out").val(),c=$("#paragraph_book").val(),d=base_url+"savechapter";swal({title:"Tambah cerita?",text:"Simpan cerita kamu dan tambah chapter bukumu.",showCancelButton:!0,showCloseButton:!0,confirmButtonColor:"#644cb6",cancelButtonColor:"#d33",confirmButtonText:"Simpan",cancelButtonText:"Batal"}).then(function(e){e.value&&(""==b||""==c?swal("Gagal!","Lengkapi Judul dan Isi Buku mu.","error"):
$.ajax({type:"POST",url:d,data:{book_id:a,chapter_title:b,paragraph_book:c},dataType:"json",beforeSend:function(){swal({title:"Menyimpan Cerita",onOpen:function(){swal.showLoading()}})},success:function(a){200==a.code&&(swal.hideLoading(),$("#chapter_title_out").val(""),$("#paragraph_book").val(""),$("#paragraph_book").froalaEditor("html.set",""),$("#backlinks").removeClass("backlink"),$("#backlinks").attr("id","backdraft"))}}))})})}
function getCategory(){$.ajax({url:base_url+"getCategory",type:"POST",dataType:"json"}).done(function(a){var b="<option value=''>Pilih Category Buku</option>";$.each(a,function(a,d){b+="<option value='"+d.category_id+"'>"+d.category_name+"</option>"});$("#category_ids").html(b)}).fail(function(){console.log("error")}).always(function(){})}2<history.length||0<document.referrer.length?console.log("a"):url&&window.History.replaceState(null,null,url);